"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:true});exports.mailingAddressSchema=exports.paginationInputSchema=exports.ssnSchema=exports.nonNegativeUsdAmountSchema=exports.usdAmountSchema=exports.phoneNumberSchema=exports.booleanSchema=exports.emailSchema=exports.urlSchema=exports.numericStringSchema=exports.largeOrEmptyStringSchema=exports.largeStringSchema=exports.simpleOrEmptyStringSchema=exports.simpleStringSchema=exports.uuidOrClientNewUuidSchema=exports.clientNewUuidSchema=exports.uuidSchema=exports.accessTokenSchema=exports.emptyStringSchema=exports.countSchema=exports.nonEmptyStringSchema=void 0;exports.genCountSchema=genCountSchema;exports.genLimitedLengthStringSchema=genLimitedLengthStringSchema;exports.genOrEmptyStringSchema=genOrEmptyStringSchema;exports.genOrNullSchema=genOrNullSchema;exports.genArraySchema=genArraySchema;exports.genStringEnumSchema=genStringEnumSchema;exports.genLimitedIntegerSchema=genLimitedIntegerSchema;exports.genLimitedFloatSchema=genLimitedFloatSchema;exports.checkAgainstSchema=checkAgainstSchema;exports.validateArgs=validateArgs;exports.validateArgsId=validateArgsId;exports.validateJson=validateJson;exports.newAccessDeniedError=newAccessDeniedError;exports.newInvalidQueryError=newInvalidQueryError;const lodash_1=__importDefault(require("lodash"));const jsonschema_1=require("jsonschema");exports.nonEmptyStringSchema={type:"string",minLength:1};exports.countSchema={type:"number",minimum:0,multipleOf:1};function genCountSchema(maximum){return{...exports.countSchema,maximum:maximum}}exports.emptyStringSchema={type:"string",maxLength:0};exports.accessTokenSchema={type:"string",maxLength:1e5};exports.uuidSchema={type:"string",pattern:/^[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}$/};exports.clientNewUuidSchema={type:"string",pattern:/^\*[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}$/};exports.uuidOrClientNewUuidSchema={type:"string",anyOf:[exports.uuidSchema,exports.clientNewUuidSchema]};exports.simpleStringSchema={type:"string",minLength:1,maxLength:1e3};function genLimitedLengthStringSchema(maxLength){return{type:"string",minLength:1,maxLength:maxLength}}exports.simpleOrEmptyStringSchema={anyOf:[exports.simpleStringSchema,exports.emptyStringSchema]};exports.largeStringSchema={type:"string",minLength:1,maxLength:1e4};exports.largeOrEmptyStringSchema={anyOf:[exports.largeStringSchema,exports.emptyStringSchema]};exports.numericStringSchema={type:"string",minLength:1,maxLength:22,pattern:"^((-?[0-9]+.[0-9]*)|(-?[0-9]*.[0-9]+)|(-?[0-9]+))$"};const __reUrl=/^\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))$/;exports.urlSchema={type:"string",minLength:1,maxLength:1e3,pattern:__reUrl};exports.emailSchema={type:"string",minLength:1,maxLength:1e3,pattern:/\S+@\S+/};exports.booleanSchema={type:"boolean"};function genOrEmptyStringSchema(schema){return{anyOf:[schema,exports.emptyStringSchema]}}function genOrNullSchema(schema){return{oneOf:[schema,{type:"null"}]}}function genArraySchema(itemSchema,minNumItems){const schema={type:"array",items:itemSchema};if(!lodash_1.default.isNil(minNumItems)){schema.minItems=minNumItems}return schema}function genStringEnumSchema(values){return{type:"string",enum:values}}function genLimitedIntegerSchema(minimum,maximum){return{type:"number",multipleOf:1,minimum:minimum,maximum:maximum}}function genLimitedFloatSchema(minimum,maximum){return{type:"number",minimum:minimum,maximum:maximum}}exports.phoneNumberSchema={type:"string",pattern:/^\+[0-9]{11,15}$/};exports.usdAmountSchema={type:"string",pattern:/^(?:-)?[0-9]{0,10}\.[0-9]{2}$/};exports.nonNegativeUsdAmountSchema={type:"string",pattern:/^[0-9]{0,10}\.[0-9]{2}$/};exports.ssnSchema={type:"string",pattern:/^[0-9]{9}$/};exports.paginationInputSchema={type:"object",properties:{first:genLimitedIntegerSchema(1,100),after:exports.simpleStringSchema}};exports.mailingAddressSchema={type:"object",properties:{line1:exports.simpleOrEmptyStringSchema,line2:exports.simpleOrEmptyStringSchema,city:exports.simpleOrEmptyStringSchema,region:exports.simpleOrEmptyStringSchema,postalCode:exports.simpleOrEmptyStringSchema}};function checkAgainstSchema(args,schema,errors){const v=new jsonschema_1.Validator;const result=v.validate(args,schema);if(result.errors.length>0){lodash_1.default.forEach(result.errors,(err=>errors.push(err)));return false}return true}function validateArgs(funcName,schema,args){const errors=[];if(!checkAgainstSchema(args,schema,errors)){console.error(funcName,errors);throw new Error("INVALID_ARGS")}}function validateArgsId(funcName,args){validateArgs(funcName,{type:"object",properties:{id:exports.uuidSchema}},args)}function validateJson(schema,obj){const errors=[];if(!checkAgainstSchema(obj,schema,errors)){console.error(errors);throw new Error("INVALID_OBJECT")}}function newAccessDeniedError(){return new Error("ACCESS_DENIED")}function newInvalidQueryError(){return new Error("INVALID_QUERY")}