"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:true});exports.genFnGenPluginList=genFnGenPluginList;const lodash_1=__importDefault(require("lodash"));function __formatPath(path){return path.prev?`${__formatPath(path.prev)}.${path.key}`:path.key.toString()}function __rootNodeKeyIs(path,key){return!path.prev?path.key.toString()===key.toString():__rootNodeKeyIs(path.prev,key)}function genFnGenPluginList({rootKey:rootKey,onExecutionDidEnd:onExecutionDidEnd}){const __genPluginList=()=>[{requestDidStart:async()=>({executionDidStart:async()=>{const key2ProfileNode={};return{willResolveField:fieldResolverParams=>{const path=fieldResolverParams.info.path;let key="";let profileNode=null;if(__rootNodeKeyIs(path,rootKey)){key=__formatPath(path);const parentKey=path.prev?__formatPath(path.prev):"";profileNode={key:key,parentKey:parentKey,startMs:(new Date).valueOf(),endMs:0,totalMs:0}}return()=>{if(profileNode){const endMs=(new Date).valueOf();profileNode.endMs=endMs;key2ProfileNode[key]=profileNode}}},executionDidEnd:async()=>{const mapWithTotals=__calcTotals(key2ProfileNode);onExecutionDidEnd({key2ProfileNode:mapWithTotals})}}}})}];return __genPluginList}function __calcTotals(key2ProfileNode){const earliestStartMs=lodash_1.default.minBy(lodash_1.default.values(key2ProfileNode),(node=>node.startMs))?.startMs??0;return lodash_1.default.mapValues(key2ProfileNode,(node=>{const totalMs=node.endMs-node.startMs;return{...node,startMs:node.startMs-earliestStartMs,endMs:node.endMs-earliestStartMs,totalMs:totalMs}}))}