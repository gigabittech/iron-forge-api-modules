"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.init=init;exports.sendEmail=sendEmail;exports.fileAndSendNotification=fileAndSendNotification;const client_sesv2_1=require("@aws-sdk/client-sesv2");const layer1_1=require("../layer1");let __config=null;function init(config){__config=config}function __getConfig(){if(!__config){throw new Error("MODULE_NOT_INITIALIZED: emailService")}return __config}function __getClient(){const config=__getConfig();return new client_sesv2_1.SESv2Client({region:config.aws.region,credentials:config.aws.credentials?{accessKeyId:config.aws.credentials.accessKeyId,secretAccessKey:config.aws.credentials.secretAccessKey}:undefined})}async function sendEmail({toEmail:toEmail,subject:subject,body:body}){const config=__getConfig();const client=__getClient();const command=new client_sesv2_1.SendEmailCommand({FromEmailAddress:config.aws.ses.fromEmail,Destination:{ToAddresses:[toEmail]},Content:{Simple:{Subject:{Data:subject},Body:{Text:{Data:body}}}}});await client.send(command);client.destroy()}async function fileAndSendNotification({toEmail:toEmail,subject:subject,body:body}){await sendEmail({toEmail:toEmail,subject:subject,body:body});return await __fileEmailNotification({toEmail:toEmail,subject:subject,body:body,isSent:true})}async function __fileEmailNotification({toEmail:toEmail,subject:subject,body:body,isSent:isSent}){const config=__getConfig();const db=layer1_1.dbService.getDb();const rows=await db.queryBuilder().insert({to_email:toEmail,subject:subject,body:body,sent_timestamp:isSent?db.raw("CLOCK_TIMESTAMP()"):null}).into(config.tableNames.emailNotification).returning(["id"]);return rows[0].id??""}